# Bitcoin and Blockchain


* A tx must be verified by miners.
* tx's are grouped together in a block. tx's in a similar time frame are grouped.
* Miners use computing power to solve a question.
* Those who solve first are **rewarded** with bitcoin.
  * This is how the BTC is created.
* When a block is **verified**, it is added to previously verified blocks.
  * Hence, creating a chain of blocks -> blockchain
* Blocks are **immutable**
  * When a block is verified, it can no longer be changed.
  * In other words, a tx cannot be undone.


---

## Consensus

* The block must be broadcasted to the BC network.
* BC network is comprised of nodes.
  * These nodes validate and relay tx.
  * They are voluntarily. Used to verify the correct TX on blockchain.
  * They follow **consensus rules**
    * These are agreed upon by the community.
  * A change in consensus rules request 95% of the community to approve.
    * That is why its hard to change the BTC software.
* Nodes do not mine BTC.
  * However, all miners typically run a full node.

---

## Mining

* Mining is solving a cryptographic puzzle.
* PoW - Proof of Work
  * SHA256.
* You need to find a hash value which starts with three zeros: 000
* You try stuff.
  * You find it in the 6518th try.
  * The first one to solve broadcast this answer and rewarded with BTC.


* A standard BTC block requires **millions** of hashes to solve the puzzle. 
* The complexity of the puzzle changes every 2016 blocks. This is to ensure that average block confirmation time takes 10 minutes.
* Because of this difficulty, we need special hashing power, that is why they use ASIC chips.
  * ASIC: Application-specific integrated circuit
  * Customized specifically for bitcoin mining.
  * Expensive
    * That's why resulted in a select group or pool of miners that dominate.

---


* Each block contains the solved hash from the parent / previous block.
* Each new block requires the parent block's hash.
* Block 30's hash is necessary for block 31.
  * B31 cannot exist until B30 is verified and added to blockchain.
  * Guarantees each block is connected all the way until the first block.
    * That is called *genesis block*
* That means if you want to change something in a block, everything needs to change starting from the genesis block.

---

* The supply of BTC is limited to 21 million BTC.
  * Estimated to occur around the year 2140.
* Amount of BTC rewarded to miners is **halved** every 210000 blocks.
  * Reward is split until the last BTC is created.
---



Uses ECDSA, a private key signs a TX. This signature can be verified by the **public key** and therefore confirms the TX integrity and origin. 



## Hash functions

Bitcoin uses the SHA-256 cryptographic hash function, which is part of the SHA-2 family developed by the National Security Agency (NSA) of the United States. Every transaction and block in the Bitcoin blockchain undergoes SHA-256 hashing. Each block header contains the hash of the previous blockâ€™s header, creating a chain that verifies the integrity of every subsequent block.

A hash function is a type of cryptographic algorithm that takes an input (or 'message') and returns a fixed-size string of bytes. The output, typically a 'digest', is unique to each unique input. Hash functions are designed to be one-way functions; they can be computed very quickly, but it is infeasible to reverse-engineer the original input from the hash output.

### SHA-256 and Bitcoin

Bitcoin uses the SHA-256 hash algorithm, which produces a 256-bit (32-byte) hash. SHA-256 stands for Secure Hash Algorithm - 256 bit and is part of the SHA-2 family of cryptographic hash functions. Here's how it's used in Bitcoin:

**Block Hashing:** Each block's header in Bitcoin must be hashed repeatedly to produce proof of work for mining, ensuring security and the chronological order of the blockchain.
**Transaction Hashing:** Every transaction is hashed using SHA-256. The transaction hashes are then used to create a Merkle tree (or binary hash tree) whose root is stored in the block's header.
**Address Generation:** Bitcoin addresses are generated by hashing public keys using SHA-256, followed by a RIPEMD-160 hash. This provides an additional layer of security.

### Role of Hash Functions in Mining

Mining involves finding a value (called a nonce) that when hashed with the block header results in a hash output that meets certain criteria (e.g., the hash has to be below a certain target). This process is known as proof of work and is critical for maintaining the ledger's integrity and security.

**Nonce Guessing:** Miners guess the nonce value and calculate the block header hash repeatedly until they find a hash that meets the network's difficulty target.
**Block Confirmation:** Once a valid hash is found, the block is considered mined, and the new block is confirmed and added to the blockchain. This block then broadcasts to other nodes in the network for verification.





## PKE

Bitcoin uses the ECDSA with the secp256k1 curve for its public key cryptography system. When a transaction is created, it is signed using the private key of the sender. This signature, which is part of the transaction, can be verified by anyone in the network using the sender's public key. This ensures that the transaction was indeed created by the owner of the bitcoins being spent and prevents alteration of the transaction once it has been issued.

* In BTC, every user generates a key pair. 
  * Private key is **private** and public key is **public**
* Keys are generated using *elliptic curve cryptography*
  * ECDSA
* BTC address is derived from the *public key*
  * It is a *hashed* version of the public key.
  * Makes it shorter and more manageable.
  * Generated by hashing the public key with SHA and then RIPEMD-160.
    * We use RIPEMD-160 because it creates a 160-bit hash, shorter.
    * Since it is done in *addition* to SHA, it makes it harder for attackers to find collisions.
      * It should be hard for an attacker to find two different public keys that hash to the same BTC address.
  
---

* When sending BTC, users create TX.
  * It is a data structure that specifies:
    * Source of fund
    * Amount
    * Destination address
* To prove ownership, TX is digitally signed using the sender's **private key**.
* Signing:
  * First take the hash of tx data.
  * Later, sign in with your private key.
* When nodes in BTC network receive a TX, they need to verify it first.
  * They check the digital signature using the sender's public key.
  * It is used to verify that the TX was indeed signed with the public key.
  * Ensures sender is legitimate owner of the BTCs in question and the TX is not altered.
* BTC addresses ideally should be used only once. 
  * A new address for each TX enhances security and privacy.
  * Once someone knows your address, they can follow it!
* PKE enables BTC to have a decentralized consensus.
  * Since only the owner of the PK can sign TX, system trusts the signature.


## PoW
Bitcoin uses the PoW algorithm to confirm transactions and produce new blocks to the chain. Miners compete to solve a difficult mathematical problem based on the SHA-256 algorithm, and the first miner to solve the problem gets the right to add the new block to the blockchain. The difficulty of this problem is adjusted every 2016 blocks to ensure that the time to find a new block remains about 10 minutes on average, regardless of the amount of computing power in the network.

* Consensus mechanism
  * Requires a participant in the network to do computationally intensive calculations to solve a cryptographic puzzle.
  * Solution to this puzzle is hard to find
    * But easy for others to verify.
* PoW puzzle is based on SHA256.
  * Challenge is to find a **nonce** that when it is hashed together with block data, it produces a block hash that meets a *certain* criteria. (a target hash - a 256bit integer)
  * Miners compete to find a **block hash** that is **less** than the target hash.
    * Imagine that target hash as a specific range of values.
    * Valid block hashes fall below that range.
  * This target hash is adjusted almost every two weeks.
    * In order to ensure an average block creation time of approx 10 min.
    * If miners solve block too quickly, target hash becomes **harder**(larger value), requiring more attempts to find a valid block hash.
    * If miners solve it too slowly, target hash becomes **easier**.
* The process of solving the puzzle is called **mining**.
  * Miners collect TX from a pool, verify their legitimacy and assemble them into a block.
  * Later, they begin the process of hashing the block's header, which includes the *Merkle root* of the transactions, the hash of the previous block, the nonce and other relevant information.
    * i.e. version number, timestamp, difficulty target.
* The difficulty of the puzzle is adjusted every 2016 blocks.
  * Ideally 2 weeks
  * Goal is to maintain average block time of about 10 mins.
* First miner to solve the puzzle and validate the block broadcasts it to network.
  * If it is accepted (meaning all tx are valid and block follows the rules), miner is **rewarded** with newly mined bitcoins **plus** transaction fees. 
  * An economic incentive for miners to contribute their computational power to the networks.

* PoW ensures that no single entity can easily alter the blockchain.
  * Because they need to redo the work for the altered block **and** all blocks coming before them.
  * Almost impossible
* **51% attack**: If an attacker controls more than 50 percent of the total computational power on the network, they can potentially create a longer chain faster than the rest of the network.
  * Highly costly and difficult.

**Problems:**
* Energy consumption
  * PoW is energy-intensive and requires significant computational power
  * Leads to high electricity usage.
  * Environmental impact.



## Merkle Trees

Each block in the Bitcoin blockchain contains a Merkle root, which is a single hash that effectively summarizes all the transactions in the block. This is useful for Bitcoin's "simplified payment verification" (SPV) mode, allowing lightweight client software to confirm the inclusion of a transaction in a block without needing the entire block's data, just the small part of the block containing the relevant Merkle path.

## Decentralization

Bitcoin maintains its security and resistance to tampering by having many independent nodes (computers) that each maintain a full copy of the blockchain. These nodes independently verify new transactions and blocks, rejecting any that do not conform to Bitcoinâ€™s rules. This decentralization ensures that no single entity can control or alter the historical record of transactions without achieving a prohibitive amount of computational power.
